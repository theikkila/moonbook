angular.module("moonbook.calendar",[]).directive("moonbookCalendar",function(){return{restrict:"AEC",templateUrl:"src/moonbookCalendarTemplate.html",scope:{multiple:"=?",selected:"=?",imonth:"=?month",year:"=?",readOnly:"=?",baseprice:"=?",days:"=?"},link:function(a,b){function c(a){return a.getFullYear()+"-"+(a.getMonth()+1)+"-"+(a.getDate()-1)}function d(){var a=(new Date).getTime(),b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==b?c:3&c|8).toString(16)});return b}function e(a,b){var c=new Date(a,b-1,1),d=new Date(a,b,0),e=c.getDay()+d.getDate()-1;return Math.ceil(e/7)}function f(b,f){a.month=[];for(var g=new Date(b,f-1,1).getDay()-1,h=new Date(b,f,0).getDate(),j=0,k=0;k<e(b,f);k++){a.month[k]=[];for(var l=0;7>l;l++)if(g>l&&0==j||j>=h)a.month[k][l]={notmonth:!0,id:d()};else{j++;var m=new Date(b,f-1,j+1),n=c(m);a.month[k][l]={notmonth:!1,dayOfMonth:j,date:m,id:d()};var o=i[n];if(a.month[k][l].available=!0,a.month[k][l].title=a.baseprice+"€",!o)continue;a.month[k][l].title=(null==o.price?a.baseprice:o.price)+"€",a.month[k][l].na=!(null==o.bookable?!1:o.bookable),a.month[k][l].na&&(a.month[k][l].title="Not available"),o.booked&&(a.month[k][l].booked=!0,a.month[k][l].available=!1,a.month[k][l].na=!1,a.month[k][l].title="Booked"),a.month[k][l].available=!a.month[k][l].na}}}a.month=[];var g=!1;b.on("mouseup",function(){g=!1});var h=["January","February","March","April","May","June","July","August","September","October","November","December"],i={};a.$watch("days",function(){console.log(a.days);for(var b=(a.days?a.days.length:0)-1;b>=0;b--)!function(a){var b=new Date(1e3*a.date),d=c(b);i[d]={price:a.price,booked:a.booked,bookable:a.bookable}}(a.days[b]);f(parseInt(a.year),parseInt(a.imonth))}),a.$watch("imonth",function(){a.monthName=h[a.imonth-1],f(parseInt(a.year),parseInt(a.imonth))}),a.$watch("year",function(){f(parseInt(a.year),parseInt(a.imonth))}),a.$watch("multiple",function(){a.selected=[],f(parseInt(a.year),parseInt(a.imonth))}),a.$watch("selected",function(b,c){for(var d=c.length-1;d>=0;d--)el=document.getElementById(c[d].element),el.classList.remove("selected"),el.dataset.selected=!1;for(var d=a.selected.length-1;d>=0;d--)el=document.getElementById(b[d].element),el.classList.add("selected"),el.dataset.selected=!0},!0),a.mousedown=function(b){g=!0,b.preventDefault(),a.select(b)},a.mouseover=function(b){g&&a.select(b)},a.select=function(b){var c=b.currentTarget;if("true"!==c.dataset.notmonth&&(a.readOnly&&""!==c.dataset.url&&(window.location=c.dataset.url),!a.readOnly))if(c.dataset.selected&&"true"===c.dataset.selected){var d=c;_.remove(a.selected,function(a){return new Date(a.day).getTime()==new Date(d.dataset.date.replace(/\"/g,"")).getTime()})}else{c.classList.add("selected"),c.dataset.selected=!0;var e=c;if(!a.multiple){for(var f=a.selected.length-1;f>=0;f--)el=document.getElementById(a.selected[f].element),el.dataset.selected=!1,el.classList.remove("selected");a.selected=[]}a.selected.push({day:new Date(e.dataset.date.replace(/\"/g,"")),element:e.id})}}}}}),angular.module("moonbook.calendar").run(["$templateCache",function(a){"use strict";a.put("src/moonbookCalendarTemplate.html",'\n	<div class="mb-calendar">\n		<div class="mb-header">\n			<h3>{{monthName}}</h3>\n		</div>\n		<table class="mb-days">\n			<thead>\n				<tr>\n					<th>monday</th>\n					<th>tueday</th>\n					<th>wednesday</th>\n					<th>thursday</th>\n					<th>friday</th>\n					<th>saturnday</th>\n					<th>sunday</th>\n				</tr>\n			</thead>\n			<tbody>\n				<tr ng-repeat="week in month">\n					<td ng-repeat="day in week" id="{{day.id}}" ng-mousedown="mousedown($event)" ng-mouseover="mouseover($event)" data-date="{{day.date}}" data-notmonth="{{day.notmonth}}" data-url="{{day.url}}" ng-class="{notmonth: day.notmonth, booked: day.booked, available: day.available, na: day.na}">{{day.title}}<span>{{day.dayOfMonth}}</span></td>\n				</tr>\n			</tbody>\n		</table>\n	</div>')}]);