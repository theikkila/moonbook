<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Test</title>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.0/angular.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>
    <link rel="stylesheet" href="calendar.css">
</head>
<body ng-app="App" ng-controller="base">
	{{a}}
<moonbook-calendar></moonbook-calendar>

</body>
<script>
var app = angular.module('App', []);

app.controller('base', function($scope) {
    $scope.a = "asd";
});

app.directive('moonbookCalendar', function () {
  return {
    restrict: 'AEC',
    templateUrl: 'calendarTemplate.html',
    link: function (scope, element, attr) {
        var multipleMode = false;
        var selected = [];
        element.find('td').on('click', function () {
                console.log(this.dataset['date']);
            if (!this.dataset['date']) {
                this.dataset['date'] = new Date();
            }
            if (this.dataset['selected'] && this.dataset['selected'] === "true") {
                // unselect
                this.classList.remove('selected');
                this.dataset['selected'] = false;
                var day = this;
                _.remove(selected, function(obj) {
                    return (new Date(obj.day)).getTime() == (new Date(day.dataset['date'])).getTime();
                });
            } else {
                this.classList.add('selected');
                this.dataset['selected'] = true;
                if (!multipleMode) {
                    for (var i = selected.length - 1; i >= 0; i--) {
                        selected[i].element.dataset['selected'] = false;
                        selected[i].element.classList.remove('selected');
                    };
                    selected = [];
                }
                selected.push({day: new Date(this.dataset['date']), element: this});
            }
            console.log(selected);
        });
    }
}
});
</script>
</html>